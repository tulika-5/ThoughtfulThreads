{% extends 'base.html' %}

{% block title %} POST {% endblock %}

{% block content %}
<div class="container-custom">
    <div class="row">
        <div class="col s12 m10">
            <h3>{{ post.title }}</h3>
            <p>( {{ post.cat.title }} )</p>
            <img src="/media/{{ post.image }}" class="responsive-img" alt="">
            <br>
            <p>{{ post.content|safe }}</p>

            <!-- Ratings Section -->
            <div>
                <h4>Ratings</h4>
                <div>
                    {% for rating in post.ratings.all %}
                        <div>
                            <strong>{{ rating.user.username }}:</strong>
                            <span>{{ rating.rating }} stars</span>
                            <p>{{ rating.opinion }}</p>
                        </div>
                    {% endfor %}
                </div>

                <h4>Leave a Rating</h4>
                <form action="{% url 'add_rating' url=url %}" method="post">


                    {% csrf_token %}
                    <div class="rating">
                        <input type="number" name="rating" hidden>
                        <i class='bx bx-star star' style="--i: 0;"></i>
                        <i class='bx bx-star star' style="--i: 1;"></i>
                        <i class='bx bx-star star' style="--i: 2;"></i>
                        <i class='bx bx-star star' style="--i: 3;"></i>
                        <i class='bx bx-star star' style="--i: 4;"></i>
                    </div>
                    <textarea name="opinion" cols="30" rows="5" placeholder="Your opinion..."></textarea>
                    <div class="btn-group">
                        <button type="submit" class="btn submit">Submit</button>
                        <button type="button" class="btn cancel">Cancel</button>
                    </div>
                </form>
            </div>
            <!-- End Ratings Section -->
        </div>

        <div class="col s12 m2">
            {% for cat in cats %}
                <div class="card item" style="margin-left:10px;">
                    <div class="img-container">
                        <img src="/media/{{ cat.image }}" class="responsive-img" alt="">
                    </div>
                    <div class="card-content">
                        <b>{{ cat.title }}</b>
                        <p class="truncate">{{ cat.description }}</p>
                        <div class="container center-align mt20">
                            <a href="/category/{{ cat.url }}" class="btn bg-primary">VIEW</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    const allStar = document.querySelectorAll('.rating .star');
    const ratingValue = document.querySelector('.rating input');

    allStar.forEach((item, idx) => {
        item.addEventListener('click', function () {
            let click = 0;
            ratingValue.value = idx + 1;

            allStar.forEach(i => {
                i.classList.replace('bxs-star', 'bx-star');
                i.classList.remove('active');
            });
            for (let i = 0; i < allStar.length; i++) {
                if (i <= idx) {
                    allStar[i].classList.replace('bx-star', 'bxs-star');
                    allStar[i].classList.add('active');
                } else {
                    allStar[i].style.setProperty('--i', click);
                    click++;
                }
            }
        });
    });
</script>
{% endblock %}
